"use strict";(self.webpackChunkhunger_game=self.webpackChunkhunger_game||[]).push([[965],{2068:function(n,t,e){e.d(t,{aR:function(){return s}});var i=e(9439),r=e(1413),o=e(9867),a=e(4670),u=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=(0,r.Z)({},n),o=new URLSearchParams(window.location.search);return Object.keys(n).forEach((function(t){var i=o.get(t);null!==i&&JSON.stringify(n[t])!==i&&(e[t]="true"===i||"false"===i?JSON.parse(i):i)})),Object.entries(t).forEach((function(t){var r=(0,i.Z)(t,2),a=r[0],u=r[1];("string"===typeof u?[u]:u).forEach((function(t){var i=o.get(t);null!==i&&JSON.stringify(n[a])!==i&&(e[a]="true"===i||"false"===i?JSON.parse(i):i)}))})),e},s=function(n,t){var e=new URLSearchParams(window.location.search);return Object.keys(n).forEach((function(t){JSON.stringify(n[t])!==e.get(t)&&e.set(t,n[t])})),void 0!==t&&Object.keys(t).forEach((function(i){null!==e.get(i)&&t[i]===n[i]&&e.delete(i)})),e.toString()};t.ZP=function(n,t){var e=o.useState((function(){return u(n)})),r=(0,i.Z)(e,2),c=r[0],l=r[1],d=(0,a.TH)().search;o.useEffect((function(){l((function(e){var i=u(n,t);return Object.keys(n).some((function(n){return i[n]!==e[n]}))?i:e}))}),[d,n,t]);var g=o.useCallback((function(t){var e;e="function"===typeof t?t(c):t,l(e),function(n,t){var e="".concat(window.location.pathname,"?").concat(s(n,t));window.history.pushState(null,"",e)}(e,n)}),[c,n]);return[c,g]}},3965:function(n,t,e){e.r(t),e.d(t,{default:function(){return B}});var i=e(3433),r=e(9439),o=e(4165),a=e(1413),u=e(5861),s=e(9867),c=e(2418),l=e(5226),d=e(3248),g=e(4964),f=e(9079),h=e(7298),v=e(4828),p=e(9801),m=e(9460),Z=e(8976),x=e(9190),_=e(8547),b=e(6070),y=e(4670),j=e(3094),w=e(4754),S=e(3768),k=e(3547),q=e(2068),C=e(4635),O=e(8514),z=e(2834),Q=function(){var n=(0,u.Z)((0,o.Z)().mark((function n(t){var e,i,r,u,s,c,l,d,g,f,h,v,p;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,S.Z.insightDetail(t);case 2:if(null===(c=n.sent)||void 0===c||null===(e=c.data)||void 0===e||!e.source_image||null===c||void 0===c||null===(i=c.data)||void 0===i||null===(r=i.data)||void 0===r||!r.logo_id||null!==c&&void 0!==c&&null!==(u=c.data)&&void 0!==u&&null!==(s=u.data)&&void 0!==s&&s.bounding_box){n.next=9;break}return n.next=6,S.Z.getLogosImages([null===c||void 0===c||null===(l=c.data)||void 0===l||null===(d=l.data)||void 0===d?void 0:d.logo_id]);case 6:return v=n.sent,p=null===v||void 0===v||null===(g=v.data)||void 0===g||null===(f=g.logos)||void 0===f||null===(h=f[0])||void 0===h?void 0:h.bounding_box,n.abrupt("return",(0,a.Z)((0,a.Z)({},c),{},{bounding_box:p}));case 9:return n.abrupt("return",c);case 10:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),P=function(n){var t=(0,c.$G)().t,e=n.question,i=n.toggleSelection,a=n.checked,l=n.imageSize,d=n.zoomOnLogo,g=s.useState(""),f=(0,r.Z)(g,2),h=f[0],Z=f[1];return s.useEffect((function(){if(d){var n=!0,t=function(){var t=(0,u.Z)((0,o.Z)().mark((function t(){var i,r,a,u;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(e.insight_id);case 2:if(r=t.sent,a=r.data,u=r.bounding_box,n){t.next=7;break}return t.abrupt("return");case 7:null!==a&&void 0!==a&&null!==(i=a.data)&&void 0!==i&&i.bounding_box&&null!==a&&void 0!==a&&a.source_image?Z(S.Z.getCroppedImageUrl(k.Z.getImageUrl(null===a||void 0===a?void 0:a.source_image),a.data.bounding_box)):u&&null!==a&&void 0!==a&&a.source_image&&Z(S.Z.getCroppedImageUrl(k.Z.getImageUrl(null===a||void 0===a?void 0:a.source_image),u));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return t().catch((function(){})),function(){n=!1}}Z(e.source_image_url)}),[e.insight_id,e.source_image_url,d]),(0,z.jsx)(v.Z,{sx:{width:l,height:l},children:(0,z.jsxs)(p.Z,{sx:{width:l,height:l,position:"relative"},onClick:i(e.insight_id),tabIndex:-1,children:[h?(0,z.jsx)("img",{src:h,alt:t("nutriscore.image_alt"),loading:"lazy",style:{objectFit:"contain",width:"100%",height:"100%"}}):(0,z.jsx)(_.Z,{children:"NOT A LOGO"}),(0,z.jsx)(m.Z,{sx:{position:"absolute",bottom:10,right:10},checked:a,readOnly:!0,size:"large"})]})},e.insight_id)},E=function(n){var t=n.insightType,e=n.valueTag,i=(0,c.$G)().t;return(0,z.jsxs)(h.Z,{sx:{width:"100%",textAlign:"center",py:5,m:0},children:[(0,z.jsx)(_.Z,{variant:"subtitle1",children:i("logos.no_more_questions")}),(0,z.jsx)(g.Z,{color:"secondary",size:"small",component:f.Z,variant:"contained",href:"/logos/deep-search?type=".concat(t,"&value=").concat(e),target:"_blank",sx:{ml:2,minWidth:150},children:"Search"})]})};function L(){var n=(0,c.$G)().t,t=(0,j.I0)(),e=(0,q.ZP)({imageSize:200,zoomOnLogo:!0},{}),o=(0,r.Z)(e,2),u=o[0],v=o[1],p=(0,y.UO)().valueTag,S=Number.parseInt(u.imageSize),k=JSON.parse(u.zoomOnLogo),O=s.useMemo((function(){var n;return null!==(n=C.B[p])&&void 0!==n?n:{}}),[p]);s.useLayoutEffect((function(){t((0,w.a8)({insightType:O.type,sortByPopularity:!1,valueTag:p,predictor:void 0===(null===O||void 0===O?void 0:O.predictor)?"universal-logo-detector":null===O||void 0===O?void 0:O.predictor}))}),[t,p,O]);var Q=s.useState([]),L=(0,r.Z)(Q,2),B=L[0],K=L[1],I=s.useState(null),T=(0,r.Z)(I,2),U=T[0],A=T[1],N=(0,j.v9)(w.SV),R=(0,j.v9)(w.b0),F=(0,j.v9)(w.t$),V=s.useCallback((function(n){var e=n.insight_id,i=n.value;return t((0,w.Tl)({insight_id:e,value:i}))}),[t]),J=(0,j.v9)(w.UB);s.useEffect((function(){J<5&&t((0,w.Oz)())}),[t,J]);var $=function(n){return function(t){t.shiftKey?K((function(t){var e=t.includes(U),r=!1,o=N.map((function(t){return t.insight_id!==n&&t.insight_id!==U||(r=!r)?r?t.insight_id:null:t.insight_id})).filter((function(n){return null!==n}));return e?[].concat((0,i.Z)(t),(0,i.Z)(o.filter((function(n){return!t.includes(n)})))):t.filter((function(n){return!o.includes(n)}))})):K((function(t){return t.includes(n)?t.filter((function(t){return t!==n})):[].concat((0,i.Z)(t),[n])})),A(n)}};return(0,z.jsxs)(h.Z,{children:[(0,z.jsxs)(h.Z,{sx:{padding:2},children:[(0,z.jsx)(_.Z,{children:n("nutriscore.label")}),(0,z.jsx)(_.Z,{children:n("nutriscore.description",{label:O.label})}),(0,z.jsxs)(_.Z,{children:["Ici vous annotez des produits. Mais vous pouvez aussi aider Robotoff en annotant des logos d\xe9tect\xe9s \xe0 cette adresse:"," ",(0,z.jsxs)(f.Z,{href:"https://hunger.openfoodfacts.org/logos/deep-search?type=label&value=".concat(O.tag),target:"_blank",children:["recherche des logos ",O.label]}),"."]})]}),(0,z.jsxs)(d.Z,{direction:"row",justifyContent:"center",alignItems:"center",sx:{pt:5,px:5,pb:0,textAlign:"center"},children:[(0,z.jsx)(_.Z,{sx:{mx:3},children:n("nutriscore.images_remaining",{remaining:R})}),O.logo&&(0,z.jsx)("img",{src:O.logo,alt:"searched logo",style:{maxHeight:75}}),(0,z.jsxs)(h.Z,{sx:{mx:2,width:500,maxWidth:500,textAlign:"left"},children:[(0,z.jsx)(_.Z,{gutterBottom:!0,children:n("nutriscore.image_sizes")}),(0,z.jsx)(x.ZP,{"aria-label":n("nutriscore.image_sizes"),value:S,onChangeCommitted:function(n,t){return v((function(n){return(0,a.Z)((0,a.Z)({},n),{},{imageSize:t})}))},valueLabelDisplay:"auto",step:50,marks:!0,min:50,max:500,sx:{maxWidth:500}})]}),(0,z.jsx)(b.Z,{onChange:function(n){return v((function(t){return(0,a.Z)((0,a.Z)({},t),{},{zoomOnLogo:n.target.checked})}))},control:(0,z.jsx)(m.Z,{checked:k}),label:n("nutriscore.zoom_on_logo"),labelPlacement:"end"})]}),(0,z.jsxs)(d.Z,{direction:"row",justifyContent:"start",alignItems:"center",sx:{px:5,py:1,textAlign:"left"},children:[(0,z.jsx)(g.Z,{onClick:function(){K(N.map((function(n){return n.insight_id})))},size:"small",sx:{mr:2},children:n("nutriscore.select_all")}),(0,z.jsx)(g.Z,{onClick:function(){K([])},size:"small",children:n("nutriscore.deselect_all")})]}),(0,z.jsx)(l.Z,{sx:{mb:4}}),(0,z.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(".concat(S+10,"px, 1fr))"),gridGap:10},onKeyDown:function(n){if(n.shiftKey){var t=N.findIndex((function(n){return n.insight_id===U}));if(-1!==t){var e;if("ArrowRight"===n.key)e=t+1;else{if("ArrowLeft"!==n.key)return;e=t-1}if(!(e<0||e>=N.length)){var r=[U,N[e].insight_id];K((function(n){return[].concat((0,i.Z)(n),(0,i.Z)(r.filter((function(t){return!n.includes(t)}))))})),A(N[e].insight_id)}}}},children:N.filter((function(n){return n.insight_id&&"NO_QUESTION_LEFT"!==n.insight_id})).map((function(n){return(0,z.jsx)(P,{question:n,toggleSelection:$,checked:B.includes(n.insight_id),imageSize:S,zoomOnLogo:k},n.insight_id)}))}),0===J&&(0,z.jsx)(E,(0,a.Z)({},F)),(0,z.jsx)(Z.Z,{sx:{paddingX:2,paddingY:1,position:"sticky",bottom:0,marginTop:2},children:(0,z.jsxs)(d.Z,{direction:"row",justifyContent:"end",children:[(0,z.jsx)(g.Z,{size:"large",variant:"contained",color:"error",onClick:function(){B.forEach((function(n){return V({value:0,insight_id:n})})),K([])},fullWidth:!0,children:n("nutriscore.incorrect")}),(0,z.jsx)(g.Z,{sx:{ml:3},size:"large",variant:"contained",color:"success",onClick:function(){B.forEach((function(n){return V({value:1,insight_id:n})})),K([])},fullWidth:!0,children:n("nutriscore.correct",{label:O.label})})]})})]})}function B(){return(0,z.jsx)(s.Suspense,{fallback:(0,z.jsx)(O.Z,{}),children:(0,z.jsx)(j.zt,{store:w.ZP,children:(0,z.jsx)(L,{})})})}},4754:function(n,t,e){e.d(t,{$Y:function(){return _},HR:function(){return j},Oz:function(){return f},SV:function(){return b},Tl:function(){return h},UB:function(){return Z},VO:function(){return S},a8:function(){return p},b0:function(){return k},rc:function(){return w},s_:function(){return x},t$:function(){return y}});var i=e(4942),r=e(3433),o=e(4165),a=e(1413),u=e(5861),s=e(4997),c=e(2917),l=e(9025),d=e(3768),g=e(5886),f=(0,s.hg)("fetchQuestions",function(){var n=(0,u.Z)((0,o.Z)().mark((function n(t,e){var i,r,u;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.getState(),n.next=3,d.Z.questions(i.questionBuffer.filterState,25,i.questionBuffer.page);case 3:return r=n.sent,u=r.data,n.abrupt("return",(0,a.Z)({page:i.questionBuffer.page,pages_size:25},u));case 6:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),h=(0,s.hg)("answerQuestion",function(){var n=(0,u.Z)((0,o.Z)().mark((function n(t){var e,i;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e=t.insight_id,i=t.value,!l.rp){n.next=5;break}return n.next=4,(0,g._v)(500);case 4:case 7:return n.abrupt("return",n.sent);case 5:return n.next=7,d.Z.annotate(e,i);case 8:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),v=(0,s.oM)({name:"questions",initialState:{page:1,questions:{},remainingQuestions:[],answeredQuestions:[],fetchCompletted:!1,numberOfQuestionsAvailable:0,filterState:{insightType:"brand",brandFilter:"",countryFilter:"",sortByPopularity:!1,valueTag:"",predictor:""}},reducers:{updateFilter:function(n,t){Object.keys(t.payload).every((function(e){return n.filterState[e]===t.payload[e]}))||(n.filterState=(0,a.Z)((0,a.Z)({},n.filterState),t.payload),n.page=1,n.remainingQuestions=[],n.fetchCompletted=!1)}},extraReducers:function(n){n.addCase(f.fulfilled,(function(n,t){var e=t.payload,i=e.questions,o=e.count,u=e.page,s=e.pages_size,c=i.filter((function(t){return void 0===n.questions[t.insight_id]})).filter((function(n){return n.source_image_url})),l={};c.forEach((function(n){l[n.insight_id]=n}));var d=Math.max(0,o-u*s),g=d+n.remainingQuestions.length+c.length,f=d>0&&0===c.length?n.page+1:n.page;return(0,a.Z)((0,a.Z)({},n),{},{page:f,remainingQuestions:[].concat((0,r.Z)(n.remainingQuestions),(0,r.Z)(c.map((function(n){return n.insight_id})))),questions:(0,a.Z)((0,a.Z)({},n.questions),l),fetchCompletted:o<25*n.page,numberOfQuestionsAvailable:g})})).addCase(h.pending,(function(n,t){var e=t.meta.arg,o=e.insight_id,u=e.value;return(0,a.Z)((0,a.Z)({},n),{},{remainingQuestions:n.remainingQuestions.filter((function(n){return n!==o})),answeredQuestions:[].concat((0,r.Z)(n.answeredQuestions),[o]),numberOfQuestionsAvailable:n.numberOfQuestionsAvailable-1,questions:(0,a.Z)((0,a.Z)({},n.questions),{},(0,i.Z)({},o,(0,a.Z)((0,a.Z)({},n.questions[o]),{},{validationValue:u,status:"pending"})))})})).addCase(h.fulfilled,(function(n,t){var e=t.meta.arg.insight_id;return(0,a.Z)((0,a.Z)({},n),{},{questions:(0,a.Z)((0,a.Z)({},n.questions),{},(0,i.Z)({},e,(0,a.Z)((0,a.Z)({},n.questions[e]),{},{status:"validated"})))})})).addCase(h.rejected,(function(n,t){var e=t.meta.arg.insight_id;return(0,a.Z)((0,a.Z)({},n),{},{questions:(0,a.Z)((0,a.Z)({},n.questions),{},(0,i.Z)({},e,(0,a.Z)((0,a.Z)({},n.questions[e]),{},{status:"failled"})))})}))}}),p=v.actions.updateFilter;t.ZP=(0,s.xC)({reducer:{questionBuffer:v.reducer}});var m=function(n){return n.questionBuffer},Z=(0,c.P1)(m,(function(n){return n.remainingQuestions.length})),x=(0,c.P1)(m,(function(n){return n.remainingQuestions.length})),_=(0,c.P1)(m,(function(n){var t;return null!==(t=n.questions[n.remainingQuestions[0]])&&void 0!==t?t:null})),b=(0,c.P1)(m,(function(n){return n.remainingQuestions.map((function(t){return n.questions[t]}))})),y=(0,c.P1)(m,(function(n){return n.filterState})),j=(0,c.P1)(m,(function(n){return n.answeredQuestions.map((function(t){return n.questions[t]}))})),w=(0,c.P1)(m,(function(n){return n.remainingQuestions.slice(1,5).map((function(t){var e;return null===(e=n.questions[t])||void 0===e?void 0:e.source_image_url})).filter((function(n){return!!n}))})),S=(0,c.P1)(m,(function(n){return!n.fetchCompletted})),k=(0,c.P1)(m,(function(n){return n.numberOfQuestionsAvailable}))},3768:function(n,t,e){var i=e(9439),r=e(1413),o=e(8025),a=e.n(o),u=e(9025),s=e(3843),c=e(5886),l={annotate:function(n,t){if(!u.rp)return a().post("".concat(u.oK,"/insights/annotate"),new URLSearchParams("insight_id=".concat(n,"&annotation=").concat(t,"&update=1")),{withCredentials:!0});console.log("Annotated, ".concat(u.oK,"/insights/annotate"),new URLSearchParams("insight_id=".concat(n,"&annotation=").concat(t,"&update=1")),{withCredentials:!0})},questionsByProductCode:function(n){return a().get("".concat(u.oK,"/questions/").concat(n)).then((function(n){var t=n.data.questions;return n.data.questions=t.filter((function(n){return n.source_image_url})),n}))},questions:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=n.insightType,o=n.brandFilter,l=n.valueTag,d=n.countryFilter,g=n.sortByPopularity,f=n.campaign,h=n.predictor,v={insight_types:i,value_tag:l,brands:(0,c.Ii)(o),country:"en:world"!==d?d:null,campaign:f,predictor:h},p=(0,s.VQ)();return a().get("".concat(u.oK,"/questions/").concat(g?"popular":"random"),{params:(0,c.BE)((0,r.Z)((0,r.Z)({},v),{},{lang:p,count:t,page:e}))})},insightDetail:function(n){return a().get("".concat(u.oK,"/insights/detail/").concat(n))},loadLogo:function(n){return a().get("".concat(u.oK,"/images/logos/").concat(n))},updateLogo:function(n,t,e){return a().put("".concat(u.oK,"/images/logos/").concat(n),(0,c.BE)({value:t,type:e}),{withCredentials:!0})},searchLogos:function(n,t,e){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:25,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=["label","category"].includes(e)?{taxonomy_value:t}:{value:t};return a().get("".concat(u.oK,"/images/logos/search/"),{params:(0,c.BE)((0,r.Z)({barcode:n,type:e,count:i,random:o},s))})},getLogoAnnotations:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,i=n.length>0?"".concat(u.oK,"/ann/search/").concat(n):"".concat(u.oK,"/ann/search");return a().get(i,{params:(0,c.BE)({index:t,count:e})})},annotateLogos:function(n){return a().post("".concat(u.oK,"/images/logos/annotate"),(0,c.BE)({annotations:n}),{withCredentials:!0})},getInsights:function(){var n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:25;return r.length&&"not_annotated"===r&&(n="0",r=""),a().get("".concat(u.oK,"/insights"),{params:(0,c.BE)({barcode:t,insight_types:e,value_tag:i,annotation:r,page:o,annotated:n,count:s})})},getUserStatistics:function(n){return a().get("".concat(u.oK,"/users/statistics/").concat(n))},getCroppedImageUrl:function(n,t){var e=(0,i.Z)(t,4),r=e[0],o=e[1],a=e[2],s=e[3];return"".concat(u.oK,"/images/crop?image_url=").concat(n,"&y_min=").concat(r,"&x_min=").concat(o,"&y_max=").concat(a,"&x_max=").concat(s)},getLogosImages:function(n){return a().get("".concat(u.oK,"/images/logos?logo_ids=").concat(n.join(",")))},getNutritionValueFromImage:function(n,t,e){var i=t.split("/"),r=i[5],o="nutrition_".concat(n);for(var s in e)if(o===s)var c=e[o].imgid;return i.length>7&&(r=i[5]+"/"+i[6]+"/"+i[7]+"/"+i[8]),a().get("".concat(u.oK,"/predict/nutrient?ocr_url=https://images.openfoodfacts.org/images/products/").concat(r,"/").concat(c,".json"))},getUnansweredValues:function(n){var t,e=null!==(t=n.page)&&void 0!==t?t:1;return e=e>=1?e:1,a().get("".concat(u.oK,"/questions/unanswered/?").concat(Object.keys((0,r.Z)((0,r.Z)({},n),{},{page:e})).filter((function(t){return void 0!==n[t]})).map((function(t){return"".concat(t,"=").concat(n[t])})).join("&")))}};t.Z=l},5886:function(n,t,e){e.d(t,{BE:function(){return a},Ii:function(){return o},VS:function(){return s},_v:function(){return u}});var i=e(9439),r={" ":"-","'":"-","&":"","\xe0":"a","\xe2":"a","\xe4":"a","\xe9":"e","\xe8":"e","\xea":"e","\xeb":"e","\xee":"i","\xef":"i","\xf4":"o","\xf6":"o","\xfb":"u","\xf9":"u","\xfc":"u"},o=function(n){if(!n)return n;for(var t=n.trim().toLowerCase(),e=0,o=Object.entries(r);e<o.length;e++){var a=(0,i.Z)(o[e],2),u=a[0],s=a[1];t=t.replace(new RegExp(u,"g"),s)}return t=t.replace(/-{2,}/g,"-")},a=function(n){return Object.keys(n).forEach((function(t){return(null==n[t]||""===n[t])&&delete n[t]})),n};function u(n){return new Promise((function(t){return setTimeout(t,n)}))}var s=function(n){if(!n)return n;var t=n.slice(3);return t.charAt(0).toUpperCase()+t.slice(1)}}}]);
//# sourceMappingURL=965.6653e7a5.chunk.js.map